##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# http://wiki.nginx.org/Pitfalls
# http://wiki.nginx.org/QuickStart
# http://wiki.nginx.org/Configuration
#
# Generally, you will want to move this file somewhere, and start with a clean
# file but keep this around for reference. Or just disable in sites-enabled.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#



server {
	server_name praktik24.com;
	listen 80 default_server;
	listen [::]:80 default_server;


	# SSL configuration
	#
	listen 443 ssl default_server;
	listen [::]:443 ssl default_server;
	# SSL encryption parameters
	ssl			on;
	ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
	ssl_ciphers 'ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA';
	ssl_prefer_server_ciphers on;

ssl_certificate		/etc/nginx/ssl/praktik24.com.crt;
ssl_certificate_key	/etc/nginx/ssl/praktik24.com.key;

# performance
ssl_session_cache	shared:SSL:10m;
ssl_session_timeout	10m;
 if ($scheme = http) {
rewrite ^ https://$server_name$request_uri permanent;
}

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.php index.html index.htm index.nginx-debian.html;


  location /myadmin/ {
    alias /usr/share/phpmyadmin/;
    #fastcgi_param PHP_value 'mbstring.func_overload =0; mbstring.internal_encoding = UTF-8;';
    index index.php;
     auth_basic "Enter Super Secret password!"; # Текст сообщения, которое увидит пользователь при попытке входа в указанную директорию
     auth_basic_user_file /etc/phpmyadmin/htpasswd.setup;


    location ~ \.php$ {
        include /etc/nginx/fastcgi_params;
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $request_filename;
        fastcgi_param PATH_INFO $fastcgi_script_name;
    }
     

}  
location ^~ /trololo/\$ {
    alias /var/www/html/trololo/index.php?q=$1;
    
    index index.php;
    #location ~ /\$ {
    #alias /var/www/html/trololo/index.php?q=$1;
        include /etc/nginx/fastcgi_params;
        fastcgi_pass unix:/run/php/php7.0-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $request_filename;
        fastcgi_param PATH_INFO $fastcgi_script_name;
        
    #}
     

}

location ~* ^/myadmin/(.+\.(jpg|jpeg|gif|css|png|js|ico|html|xml|txt))$ {
    alias /usr/share/phpmyadmin/$1;
}
 #error_page 404 = /404.php;
	#My settings
	proxy_buffering on;
   #if (!-e $request_filename) {
    # rewrite  ^(.*)$  /bitrix/urlrewrite.php last;
   #}

	location / {
                   try_files       $uri $uri/ @bitrix;
           }	
  

           location ~ \.php$ {
                   try_files       $uri @bitrix;
                    fastcgi_pass unix:/run/php/php7.0-fpm.sock;
                   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                   include fastcgi_params;
                   error_page 404 = /404.php;
           }
   
           location @bitrix {
                   fastcgi_pass unix:/run/php/php7.0-fpm.sock;
                   include fastcgi_params;
                   fastcgi_param SCRIPT_FILENAME $document_root/bitrix/urlrewrite.php;
           }
   
           location ^~ /bitrix/admin/ {
                   try_files       $uri @bitrixadm;
                    fastcgi_pass unix:/run/php/php7.0-fpm.sock; #ïóòü äî ñîêåòà php-fpm

                   fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                   include fastcgi_params;
           }
           location @bitrixadm{
                    fastcgi_pass unix:/run/php/php7.0-fpm.sock; #ïóòü äî ñîêåòà php-fpm
                   include fastcgi_params;
                   fastcgi_param SCRIPT_FILENAME $document_root/bitrix/admin/404.php;
           }
   
           location = /favicon.ico {
                   log_not_found off;
                   access_log off;
           }
   
           location = /robots.txt {
                   allow all;
                   log_not_found off;
                   access_log off;
           }
           #location ~* ^.+\.(jpg|jpeg|gif|png|svg|js|css|mp3|ogg|mpe?g|avi|zip|gz|bz2?|rar)$ {
           #        access_log off;
           #        expires max;
           #        error_page 404 = /404.php;
           #}
   
           location ~ (/\.ht|/bitrix/modules|/upload/support/not_image|/bitrix/php_interface) {
               deny all;
           }
 
           location ~ /.svn/ {
              deny all;
           }
   
           location ~ /\.ht {
               deny  all;
           }


}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
server {
	listen 80;
	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
}
